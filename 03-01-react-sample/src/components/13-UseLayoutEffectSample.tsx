import { useState, useEffect, useLayoutEffect } from 'react'

/** ğŸ“Œ useLayoutEffect - ë¶€ê°€ì‘ìš© í›…
 * ë¶€ê°€ì‘ìš©ì€ ì»´í¬ë„ŒíŠ¸ì˜ ê·¸ë¦¬ê¸°ì™€ëŠ” ì§ì ‘ì ì¸ ê´€ê³„ê°€ ì—†ëŠ” ì²˜ë¦¬ë¥¼ ë§í•©ë‹ˆë‹¤.
 * e.g. í™”ë©´ì„ ê·¸ë¦° DOMì˜ ìˆ˜ë™ë³€ê²½, ë¡œê·¸ì¶œë ¥, íƒ€ì´ë¨¸ ì„¤ì •, ë°ì´í„° ì·¨ë“ ë“±
 *
 * useEffectì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë¶€ê°€ì‘ìš©ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ í›…ì´ì§€ë§Œ, ì‹¤í–‰ë˜ëŠ” ì‹œì ì´ ë‹¤ë¦…ë‹ˆë‹¤.
 * - useEffectëŠ” í™”ë©´ ê·¸ë¦¬ê¸° í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ê³ , DOMì´ ì—…ë°ì´íŠ¸ë˜ê³ , í™”ë©´ì— ì‹¤ì œë¡œ ê·¸ë ¤ì§„ ë’¤ì— ì‹¤í–‰ë©ë‹ˆë‹¤.
 * - useLayoutEffectëŠ” DOMì´ ì—…ë°ì´íŠ¸ëœ í›„, í™”ë©´ì— ì‹¤ì œë¡œ ê·¸ë ¤ì§€ê¸° ì „ì— ì‹¤í–‰ë©ë‹ˆë‹¤.
 */

// íƒ€ì´ë¨¸ê°€ í˜¸ì¶œë˜ëŠ” ì£¼ê¸°ë¥¼ 1ì´ˆë¡œ í•œë‹¤
const UPDATE_CYCLE = 1000

// localstorageì—ì„œ ì‚¬ìš©í•˜ëŠ” í‚¤
const KEY_LOCALE = 'KEY_LOCALE'

enum Locale {
  US = 'en-US',
  KO = 'ko-KR',
}

const getLocaleFromString = (text: string) => {
  switch (text) {
    case Locale.US:
      return Locale.US
    case Locale.KO:
      return Locale.KO
    default:
      return Locale.US
  }
}

const Clock = () => {
  const [timestamp, setTimestamp] = useState(new Date())
  const [locale, setLocale] = useState(Locale.US)

  /*** (1) íƒ€ì´ë¨¸ë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•œ ë¶€ê°€ì‘ìš©
   * setInterval()ë¥¼ ì‚¬ìš©í•´, ì£¼ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬ë¥¼ ì‹¤í–‰
   * ë”°ë¼ì„œ ì´ˆê¸°í™” ì²˜ë¦¬ëŠ” ì´ˆê¸° ê·¸ë¦¬ê¸°ì—ì„œë§Œ ìˆ˜í–‰
   *
   * useEffectì˜ ë‘ë²ˆì¨° ì¸ìˆ˜ëŠ” ì˜ì¡´ë°°ì—´ì´ë©°,
   * useCallback, useMemoì™€ ë§ˆì°¬ê°€ì§€ë¡œ ê·¸ë¦´ ë–„ë§ˆë‹¤ ë‚´ìš©ì„ í™•ì¸í•´ì„œ,
   * ì´ì „ì˜ ê·¸ë¦¬ê¸° ë•Œì™€ ë‹¤ë¥¼ ê²½ìš°ì—ë§Œ ì²« ë²ˆì¨° ì¸ìˆ˜ì˜ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
   * ë¹ˆ ë°°ì˜ë¥´ ì „ë‹¬í•  ê²½ìš°, ì´ˆê¸° ê·¸ë¦¬ê¸°ë¥¼ ë§ˆì¹œ ì§í›„ì—ë§Œ ì‹¤í–‰ë˜ë©°, ê·¸ ë’¤ ë‹¤ì‹œ ê·¸ë¦´ ë•ŒëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
   */
  useEffect(() => {
    // íƒ€ì´ë¨¸ ì…‹, setTimeout()ì„ í˜¸ì¶œí•˜ê³  ìƒíƒœë¥¼ 1ì´ˆë§ˆë‹¤ ë‹¤ì‹œ ê·¸ë¦¬ë©°, í˜„ì¬ ì‹œê° í‘œì‹œë¥¼ ì—…ë°ì´íŠ¸
    const timer = setInterval(() => {
      setTimestamp(new Date())
    }, UPDATE_CYCLE)

    /** í´ë¦°ì—… í•¨ìˆ˜ë¥¼ ì „ë‹¬í•˜ê³ , ì–¸ë§ˆìš´íŠ¸ ì‹œì— íƒ€ì´ë¨¸ë¥¼ í•´ì œí•œë‹¤
     * ì–¸ë§ˆìš´íŠ¸ ì‹œì— íƒ€ì´ë¨¸ë¥¼ í•´ì œí•˜ì§€ ì•Šìœ¼ë©´, ë¶€ëª¨ ì»¤í¬ë„ŒíŠ¸ì—ì„œ Clock ì»¤í¬ë„ŒíŠ¸ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„, íƒ€ì´ë¨¸ê°€ ê³„ì† ë™ì‘í•©ë‹ˆë‹¤.
     * ì´ëŠ” ë²„ê·¸ë‚˜ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ì˜ ì›ì¸ë˜ë¯€ë¡œ, í´ë¦°ì—… í•¨ìˆ˜ì—ì„œ ì•„ë˜ì™€ ê°™ì´ ì²˜ë¦¬í•´ì¤˜ì•¼ ë©ë‹ˆë‹¤.
     */
    return () => {
      clearInterval(timer)
    }
    // ë¡œê¸° ê·¸ë¦¬ê¸° ì‹œì—ë§Œ ì‹¤í–‰í•œë‹¤
  }, [])

  /*** (2) localstorageë¡œë¶€í„° ê°’ì„ ë¡œë”©í•˜ê¸° ìœ„í•œ ë¶€ê°€ì‘ìš©
   * ğŸ’¡ useEffectì—ì„œ useLayoutEffectë¡œ ë³€ê²½í•œë‹¤
   * ì´ˆê¸° í™”ë©´ ê·¸ë¦¬ê¸°ì—ì„œ ê¸°ë³¸ê°’ì´ USí‘œê¸°ë¡œ í‘œì‹œë˜ë©°, ê·¸ ì§í›„ localstorageì— ì €ì¥ëœ í‘œê¸°ë¡œ ë°”ë€ë‹ˆë‹¤.
   * ê·¸ë˜ì„œ ë¦¬ë¡œë“œí•  ë–„ ì ê¹ë™ì•ˆ USí‘œê¸°ë¡œ í‘œì‹œë˜ë©°, ì‚´ì§ ì´ìƒí•˜ê²Œ ë³´ì…ë‹ˆë‹¤.
   * useLayoutEffectë¥¼ ì‚¬ìš©í•˜ë©´, ì´ˆê¸°í™”ë©´ì´ ë°˜ì˜ë˜ê¸° ì „ì— localstorageë¡œë¶€í„° ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ë¯€ë¡œ,
   * ì´ëŸ° í˜„ìƒì„ ì—†ì•¨ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
   *
   * ğŸš¨ í•˜ì§€ë§Œ, useLayoutEffectë¡œ ì‹¤í–‰í•˜ëŠ” ì²˜ë¦¬ëŠ” ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë¯€ë¡œ,
   * ë¬´ê±°ìš´ ì²˜ë¦¬ë¥¼ ì‹¤í–‰í•˜ë©´ í™”ë©´ ê·¸ë¦¬ê¸°ê°€ ì§€ì—°ë˜ë¯€ë¡œ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.
   */
  useLayoutEffect(() => {
    const savedLocale = localStorage.getItem(KEY_LOCALE)
    if (savedLocale !== null) {
      setLocale(getLocaleFromString(savedLocale))
    }
  }, [])

  /*** (3) localeì´ ë°”ë€Œì—ˆì„ ë•Œ, localstorageì— ê°’ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ë¶€ê°€ì‘ìš©
   * ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
   * í™”ë©´ì„ ê·¸ë¦´ ë–„ë§ˆë‹¤ ì €ì¥í•  í•„ìš”ëŠ” ì—†ìœ¼ë©°, ë“œë¡­ë‹¤ìš´ ë©”ë‰´ë¥¼ ì„ íƒí•´ localeì´ ì—…ë°ì´íŠ¸ë  ë–„ë§Œ ì €ì¥í•˜ë©´ ë˜ë¯€ë¡œ,
   * ì˜ì¡´ ë°°ì—´ì— localeì„ ì „ë‹¬í•©ë‹ˆë‹¤.
   *
   * ì¦‰, ì˜ì¡´ ë°°ì—´ì— localeì„ ì „ë‹¬í•˜ê³ , localeì´ ë³€í™”í•  ë•Œë§ˆë‹¤ ì‹¤í–‰í•˜ë„ë¡ í•œë‹¤
   */
  useEffect(() => {
    localStorage.setItem(KEY_LOCALE, locale)
  }, [locale])

  return (
    <div>
      <p>
        <span id="current-time-label">í˜„ì¬ ì‹œê°</span>
        <span>:{timestamp.toLocaleString(locale)}</span>
        <select value={locale} onChange={e => setLocale(getLocaleFromString(e.target.value))}>
          <option value="en-US">en-US</option>
          <option value="ko-KR">ko-KR</option>
        </select>
      </p>
    </div>
  )
}

export default Clock

/*** ë¦¬ì•¡íŠ¸ 18ì—ì„œ useEffect/useLayoutEffectì˜ ì‘ë™
 * ë¦¬ì•¡íŠ¸18ì—ì„œ <React.StrictMode> ì•„ë˜ ì»´í¬ë„ŒíŠ¸ ì•ˆì—ì„œ
 * ì„ ì–¸ëœ useEffect/useLayoutEffectì€ ì•ˆì „í•˜ì§€ ì•Šì€ ë¶€ê°€ì‘ìš©ì„ ë°œê²¬í•˜ê¸° ìœ„í•´ ì»´í¬ë„ŒíŠ¸ëŠ” 2ë²ˆ ê·¸ë¦½ë‹ˆë‹¤.
 *
 * ê·¸ë˜ì„œ ë¹ˆ ë°°ì—´ì„ ì „ë‹¬í–ˆì„ ë–„,
 * ë§ˆìš´íŠ¸ ì‹œì— useEffect/useLayoutEffectê°€ 2ë²ˆ í˜¸ì¶œë©ë‹ˆë‹¤.
 * ë˜í•œ í´ë¦°ì—… í•¨ìˆ˜ë„ 1ë²ˆ í˜¸ì¶œë©ë‹ˆë‹¤.
 * 1ë²ˆë§Œ ì‹¤í–‰ë˜ë„ë¡ ë³´ì¥í•  ë–„ëŠ”, useRef ë“±ì„ ì‚¬ìš©í•´ ì•ì—ì„œ ì‹¤í–‰ ìœ ë¬´ë¥¼ ì €ì¥í•´ì„œ ëŒ€ì²˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
 * ```
 * const mounted = React.useRef(false)
 * useEffect(() => {
 *  if(mounted.current) {
 *    // ì´ë¯¸ ì‹¤í–‰ ì™„ë£¡ë‹ˆ ê²½ìš° ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ”ë‹¤.
 *    return
 *  }
 *  mounted.current = true
 *
 *  // 1ë²ˆë§Œ ì‹¤í–‰í•˜ê³  ì‹¶ì€ ë¶€ê°€ ì‘ìš©ì„ ì‹¤í–‰í•œë‹¤
 *  const data = fetch(...)
 * }, [])
 * ```
 */
